'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var coreutil_v1 = require('coreutil_v1');

const LOG$1 = new coreutil_v1.Logger("StoreConfig");

class DBConfigurer {

    /**
     * 
     * @param {StoreConfig} storeConfig 
     */
    constructor(storeConfig) {
        this.storeConfig = storeConfig;
    }

    /**
     * 
     * @param {IDBVersionChangeEvent} versionChangeEvent 
     */
    updgrade(versionChangeEvent) {
        LOG$1.info("Upgrade needed");

        /** @type {IDBDatabase} */
        const db = versionChangeEvent.target.result;

        if (db.objectStoreNames.contains(this.storeConfig.storeName)) {
            db.deleteObjectStore(this.storeConfig.storeName);
        }

        const store = db.createObjectStore(
            this.storeConfig.storeName, 
            { keyPath: this.storeConfig.keyPath }
        );

        const index = store.createIndex(
            this.storeConfig.indexName, 
            this.storeConfig.indexPath, 
            {unique: this.storeConfig.indexUnique}
        );
    }

}

class IndexConfig {

    /**
     * 
     * @param {String} name 
     * @param {String} path 
     * @param {Boolean} unique 
     */
    constructor(name, path, unique) {

        /** @type {String} */
        this.name = name;

        /** @type {String} */
        this.path = path;

        /** @type {Boolean} */
        this.unique = unique;
    }

}

class StoreConfig {

        constructor() {

            /** @type {Number} */
            this.version = 1;

            /** @type {String} */
            this.storeName = null;

            /** @type {String} */
            this.keyPath = null;

            /** @type {List} */
            this.indexList = new coreutil_v1.List();

        }

        /**
         * 
         * @param {Number} version 
         */
        withVersion(version) {
            this.version = version;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withStoreName(storeName) {
            this.storeName = storeName;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withKeyPath(keyPath) {
            this.keyPath = keyPath;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withIndex(name, path, unique) {
            this.indexList.add(new IndexConfig(name, path, unique));
            return true;
        }

}

class SubscriptionManager {

    constructor() {
        this.putSubscribers = new coreutil_v1.List();
        this.deleteSubscribers = new coreutil_v1.List();
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @param {ObjectFunction} putSubscriber 
     * @param {ObjectFunction} deleteSubscriber 
     */
    subscribe(putSubscriber, deleteSubscriber) {
        if (putSubscriber instanceof coreutil_v1.ObjectFunction) {
            this.putSubscribers.add(new WeakRef(putSubscriber));
        }
        if (deleteSubscriber instanceof coreutil_v1.ObjectFunction) {
            this.deleteSubscribers.add(new WeakRef(deleteSubscriber));
        }
    }

    notifyPut(entity) {
        let toRemoveArray = [];
        this.putSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {ObjectFunction} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(entity);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.putSubscribers.remove(toRemove);
        });
    }

    notifyDelete(key) {
        let toRemoveArray = [];
        this.deleteSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {ObjectFunction} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(key);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.deleteSubscribers.remove(toRemove);
        });
    }

}

/**
 * Manages a database with 0 to many stores
 */
class DBManager {

    /**
     * 
     * @param {IDBDatabase} db 
     */
    constructor(db) {
        
        /** @type {IDBDatabase} */
        this.db = db;

        /** @type {Map} */
        this.subscriptionManagerMap = new coreutil_v1.Map();
    }

    /**
     * 
     * @param {String} dbName 
     * @param {StoreConfig} storeConfig 
     * @return {Promise}
     */
    static fromStore(dbName, storeConfig) {
        const dbConfigurer = new DBConfigurer(storeConfig);
        return new Promise((resolve, reject) => {
            const openRequest = window.indexedDB.open(dbName, 1);
            openRequest.onerror = (error) => {
                LOG.error(error);
                reject(error);
            };
            openRequest.onsuccess = () => {
                resolve(new DBManager(openRequest.result));
            };
            openRequest.onupgradeneeded = dbConfigurer.updgrade;
        });
    }

    /**
     * @returns {Object}
     */
    static mapEntity(type, dataObject) {
        if (dataObject) {
            return Object.assign(new type, dataObject);
        }
        return null;
    }


    /**
     * 
     * @param {String} storeName 
     * @param {IDBTransactionMode} transactionType readwrite
     * @returns {IDBTransaction}
     */
    transaction(transactionType, storeName) {
        return this.db.transaction(storeName, transactionType);
    }

    /**
     * 
     * @param {IDBTransaction} transaction
     * @param {String} storeName
     * @returns {IDBOjectStore}
     */
    objectStore(transaction, storeName) {
        return transaction.objectStore(storeName);
    }

    /**
     * 
     * @param {IDBObjectStore} objectStore 
     * @param {String} indexName
     * @returns {IDBIndex}
     */
    index(objectStore, indexName) {
        return objectStore.index(indexName);
    }

    /**
     * @param {Object} entity
     * @param {String} storeName
     * @param {String} transactionType
     * @return {Promise}
     */
    putEntity(entity, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const putRequest = store.put(entity);
        const context = this;
        return new Promise((resolve, reject) => {
            putRequest.onsuccess = () => { context.notifyPut(entity, storeName); resolve(entity); };
            putRequest.onerror = (error) => { reject(error); };
        });
    }


        /**
     * 
     * @param {String} key 
     * @param {String} storeName
     * @param {Class} type
     * @returns {Promise}
     */
    getEntity(key, type, storeName) {
        const transaction = this.transaction("readonly", storeName);
        const userStore = transaction.objectStore(storeName);
        const getRequest = userStore.get(key);
        return new Promise((resolve, reject) => {
            getRequest.onsuccess = () => { resolve(DBManager.mapEntity(type, getRequest.result)); };
            getRequest.onerror = (error) => { reject(error); };
        });
    }

    /**
     * 
     * @param {String} key 
     * @returns {Promise}
     */
    deleteEntity(key, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const deleteRequest = store.delete(key);
        const context = this;
        return new Promise((resolve, reject) => {
            deleteRequest.onsuccess = () => {  context.notifyDelete(key, storeName); resolve(deleteRequest.result); };
            deleteRequest.onerror = (error) => {reject(error); };
        });
    }

    notifyDelete(key, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyDelete(key);
        }
    }

    notifyPut(entity, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyPut(entity);
        }
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {ObjectFunction} objectFunction
     */
    subscribePut(storeName, objectFunction) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribe(objectFunction);
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {ObjectFunction} putObjectFunction
     * @type {ObjectFunction} deleteObjectFunction
     */
    subscribe(putObjectFunction, deleteObjectFunction, storeName) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribe(putObjectFunction, deleteObjectFunction);
    }

}

exports.DBConfigurer = DBConfigurer;
exports.DBManager = DBManager;
exports.IndexConfig = IndexConfig;
exports.StoreConfig = StoreConfig;
exports.SubscriptionManager = SubscriptionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0c3RvcmVfdjEuanMiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYkNvbmZpZ3VyZXIuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvaW5kZXhDb25maWcuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvc3RvcmVDb25maWcuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvc3Vic2NyaXB0aW9uTWFuYWdlci5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYk1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcblxyXG5jb25zdCBMT0cgPSBuZXcgTG9nZ2VyKFwiU3RvcmVDb25maWdcIik7XHJcblxyXG5leHBvcnQgY2xhc3MgREJDb25maWd1cmVyIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtTdG9yZUNvbmZpZ30gc3RvcmVDb25maWcgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHN0b3JlQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yZUNvbmZpZyA9IHN0b3JlQ29uZmlnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge0lEQlZlcnNpb25DaGFuZ2VFdmVudH0gdmVyc2lvbkNoYW5nZUV2ZW50IFxyXG4gICAgICovXHJcbiAgICB1cGRncmFkZSh2ZXJzaW9uQ2hhbmdlRXZlbnQpIHtcclxuICAgICAgICBMT0cuaW5mbyhcIlVwZ3JhZGUgbmVlZGVkXCIpO1xyXG5cclxuICAgICAgICAvKiogQHR5cGUge0lEQkRhdGFiYXNlfSAqL1xyXG4gICAgICAgIGNvbnN0IGRiID0gdmVyc2lvbkNoYW5nZUV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgIGlmIChkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHRoaXMuc3RvcmVDb25maWcuc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICBkYi5kZWxldGVPYmplY3RTdG9yZSh0aGlzLnN0b3JlQ29uZmlnLnN0b3JlTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFxyXG4gICAgICAgICAgICB0aGlzLnN0b3JlQ29uZmlnLnN0b3JlTmFtZSwgXHJcbiAgICAgICAgICAgIHsga2V5UGF0aDogdGhpcy5zdG9yZUNvbmZpZy5rZXlQYXRoIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IHN0b3JlLmNyZWF0ZUluZGV4KFxyXG4gICAgICAgICAgICB0aGlzLnN0b3JlQ29uZmlnLmluZGV4TmFtZSwgXHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmVDb25maWcuaW5kZXhQYXRoLCBcclxuICAgICAgICAgICAge3VuaXF1ZTogdGhpcy5zdG9yZUNvbmZpZy5pbmRleFVuaXF1ZX1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxufSIsImV4cG9ydCBjbGFzcyBJbmRleENvbmZpZyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGggXHJcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHVuaXF1ZSBcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgcGF0aCwgdW5pcXVlKSB7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xyXG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7Qm9vbGVhbn0gKi9cclxuICAgICAgICB0aGlzLnVuaXF1ZSA9IHVuaXF1ZTtcclxuICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBMaXN0IH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcbmltcG9ydCB7IEluZGV4Q29uZmlnIH0gZnJvbSBcIi4vaW5kZXhDb25maWcuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTdG9yZUNvbmZpZyB7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtOdW1iZXJ9ICovXHJcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IDE7XHJcblxyXG4gICAgICAgICAgICAvKiogQHR5cGUge1N0cmluZ30gKi9cclxuICAgICAgICAgICAgdGhpcy5zdG9yZU5hbWUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtTdHJpbmd9ICovXHJcbiAgICAgICAgICAgIHRoaXMua2V5UGF0aCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvKiogQHR5cGUge0xpc3R9ICovXHJcbiAgICAgICAgICAgIHRoaXMuaW5kZXhMaXN0ID0gbmV3IExpc3QoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gdmVyc2lvbiBcclxuICAgICAgICAgKi9cclxuICAgICAgICB3aXRoVmVyc2lvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogXHJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZSBcclxuICAgICAgICAgKi9cclxuICAgICAgICB3aXRoU3RvcmVOYW1lKHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlTmFtZSA9IHN0b3JlTmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHdpdGhLZXlQYXRoKGtleVBhdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5rZXlQYXRoID0ga2V5UGF0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHdpdGhJbmRleChuYW1lLCBwYXRoLCB1bmlxdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5pbmRleExpc3QuYWRkKG5ldyBJbmRleENvbmZpZyhuYW1lLCBwYXRoLCB1bmlxdWUpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxufSIsImltcG9ydCB7IExpc3QsIE9iamVjdEZ1bmN0aW9uIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uTWFuYWdlciB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5wdXRTdWJzY3JpYmVycyA9IG5ldyBMaXN0KCk7XHJcbiAgICAgICAgdGhpcy5kZWxldGVTdWJzY3JpYmVycyA9IG5ldyBMaXN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpYmVycyBhcmUgd2Vha2x5IHJlZmVyZW5jZWQuIEtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIFxyXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE9iamVjdEZ1bmN0aW9uIHRvIGVuc3VyZSBpdCBpcyBub3QgYXV0b21hdGljYWxseVxyXG4gICAgICogcmVtb3ZlZC5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtPYmplY3RGdW5jdGlvbn0gcHV0U3Vic2NyaWJlciBcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0RnVuY3Rpb259IGRlbGV0ZVN1YnNjcmliZXIgXHJcbiAgICAgKi9cclxuICAgIHN1YnNjcmliZShwdXRTdWJzY3JpYmVyLCBkZWxldGVTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgaWYgKHB1dFN1YnNjcmliZXIgaW5zdGFuY2VvZiBPYmplY3RGdW5jdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLmFkZChuZXcgV2Vha1JlZihwdXRTdWJzY3JpYmVyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZWxldGVTdWJzY3JpYmVyIGluc3RhbmNlb2YgT2JqZWN0RnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kZWxldGVTdWJzY3JpYmVycy5hZGQobmV3IFdlYWtSZWYoZGVsZXRlU3Vic2NyaWJlcikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBub3RpZnlQdXQoZW50aXR5KSB7XHJcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLmZvckVhY2goKHdlYWtSZWZTdWJzY3JpYmVyLCBwYXJlbnQpID0+IHtcclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gKi9cclxuICAgICAgICAgICAgbGV0IHN1YnNjcmliZXIgPSB3ZWFrUmVmU3Vic2NyaWJlci5kZXJlZigpO1xyXG4gICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNhbGwoZW50aXR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHV0U3Vic2NyaWJlcnMucmVtb3ZlKHRvUmVtb3ZlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBub3RpZnlEZWxldGUoa2V5KSB7XHJcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmRlbGV0ZVN1YnNjcmliZXJzLmZvckVhY2goKHdlYWtSZWZTdWJzY3JpYmVyLCBwYXJlbnQpID0+IHtcclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gKi9cclxuICAgICAgICAgICAgbGV0IHN1YnNjcmliZXIgPSB3ZWFrUmVmU3Vic2NyaWJlci5kZXJlZigpO1xyXG4gICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNhbGwoa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlU3Vic2NyaWJlcnMucmVtb3ZlKHRvUmVtb3ZlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBNYXAsIE9iamVjdEZ1bmN0aW9uIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcbmltcG9ydCB7IERCQ29uZmlndXJlciB9IGZyb20gXCIuL2RiQ29uZmlndXJlci5qc1wiO1xyXG5pbXBvcnQgeyBTdG9yZUNvbmZpZyB9IGZyb20gXCIuL3N0b3JlQ29uZmlnLmpzXCI7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbk1hbmFnZXIgfSBmcm9tIFwiLi9zdWJzY3JpcHRpb25NYW5hZ2VyLmpzXCI7XHJcblxyXG4vKipcclxuICogTWFuYWdlcyBhIGRhdGFiYXNlIHdpdGggMCB0byBtYW55IHN0b3Jlc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIERCTWFuYWdlciB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7SURCRGF0YWJhc2V9IGRiIFxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihkYikge1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKiBAdHlwZSB7SURCRGF0YWJhc2V9ICovXHJcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xyXG5cclxuICAgICAgICAvKiogQHR5cGUge01hcH0gKi9cclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYk5hbWUgXHJcbiAgICAgKiBAcGFyYW0ge1N0b3JlQ29uZmlnfSBzdG9yZUNvbmZpZyBcclxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmcm9tU3RvcmUoZGJOYW1lLCBzdG9yZUNvbmZpZykge1xyXG4gICAgICAgIGNvbnN0IGRiQ29uZmlndXJlciA9IG5ldyBEQkNvbmZpZ3VyZXIoc3RvcmVDb25maWcpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZW5SZXF1ZXN0ID0gd2luZG93LmluZGV4ZWREQi5vcGVuKGRiTmFtZSwgMSk7XHJcbiAgICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IERCTWFuYWdlcihvcGVuUmVxdWVzdC5yZXN1bHQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcGVuUmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBkYkNvbmZpZ3VyZXIudXBkZ3JhZGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgbWFwRW50aXR5KHR5cGUsIGRhdGFPYmplY3QpIHtcclxuICAgICAgICBpZiAoZGF0YU9iamVjdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgdHlwZSwgZGF0YU9iamVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZSBcclxuICAgICAqIEBwYXJhbSB7SURCVHJhbnNhY3Rpb25Nb2RlfSB0cmFuc2FjdGlvblR5cGUgcmVhZHdyaXRlXHJcbiAgICAgKiBAcmV0dXJucyB7SURCVHJhbnNhY3Rpb259XHJcbiAgICAgKi9cclxuICAgIHRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uVHlwZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCB0cmFuc2FjdGlvblR5cGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge0lEQlRyYW5zYWN0aW9ufSB0cmFuc2FjdGlvblxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZVxyXG4gICAgICogQHJldHVybnMge0lEQk9qZWN0U3RvcmV9XHJcbiAgICAgKi9cclxuICAgIG9iamVjdFN0b3JlKHRyYW5zYWN0aW9uLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtJREJPYmplY3RTdG9yZX0gb2JqZWN0U3RvcmUgXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5kZXhOYW1lXHJcbiAgICAgKiBAcmV0dXJucyB7SURCSW5kZXh9XHJcbiAgICAgKi9cclxuICAgIGluZGV4KG9iamVjdFN0b3JlLCBpbmRleE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gb2JqZWN0U3RvcmUuaW5kZXgoaW5kZXhOYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlbnRpdHlcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWVcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0cmFuc2FjdGlvblR5cGVcclxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICAgIHB1dEVudGl0eShlbnRpdHksIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy50cmFuc2FjdGlvbihcInJlYWR3cml0ZVwiLCBzdG9yZU5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgICAgICBjb25zdCBwdXRSZXF1ZXN0ID0gc3RvcmUucHV0KGVudGl0eSk7XHJcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgcHV0UmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7IGNvbnRleHQubm90aWZ5UHV0KGVudGl0eSwgc3RvcmVOYW1lKTsgcmVzb2x2ZShlbnRpdHkpOyB9O1xyXG4gICAgICAgICAgICBwdXRSZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHsgcmVqZWN0KGVycm9yKTsgfTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZVxyXG4gICAgICogQHBhcmFtIHtDbGFzc30gdHlwZVxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICAgIGdldEVudGl0eShrZXksIHR5cGUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy50cmFuc2FjdGlvbihcInJlYWRvbmx5XCIsIHN0b3JlTmFtZSk7XHJcbiAgICAgICAgY29uc3QgdXNlclN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgICAgICBjb25zdCBnZXRSZXF1ZXN0ID0gdXNlclN0b3JlLmdldChrZXkpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGdldFJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4geyByZXNvbHZlKERCTWFuYWdlci5tYXBFbnRpdHkodHlwZSwgZ2V0UmVxdWVzdC5yZXN1bHQpKTsgfTtcclxuICAgICAgICAgICAgZ2V0UmVxdWVzdC5vbmVycm9yID0gKGVycm9yKSA9PiB7IHJlamVjdChlcnJvcik7IH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkgXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICAgICAqL1xyXG4gICAgZGVsZXRlRW50aXR5KGtleSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLnRyYW5zYWN0aW9uKFwicmVhZHdyaXRlXCIsIHN0b3JlTmFtZSk7XHJcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG4gICAgICAgIGNvbnN0IGRlbGV0ZVJlcXVlc3QgPSBzdG9yZS5kZWxldGUoa2V5KTtcclxuICAgICAgICBjb25zdCBjb250ZXh0ID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHsgIGNvbnRleHQubm90aWZ5RGVsZXRlKGtleSwgc3RvcmVOYW1lKTsgcmVzb2x2ZShkZWxldGVSZXF1ZXN0LnJlc3VsdCk7IH07XHJcbiAgICAgICAgICAgIGRlbGV0ZVJlcXVlc3Qub25lcnJvciA9IChlcnJvcikgPT4ge3JlamVjdChlcnJvcik7IH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbm90aWZ5RGVsZXRlKGtleSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5jb250YWlucyhzdG9yZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5ub3RpZnlEZWxldGUoa2V5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbm90aWZ5UHV0KGVudGl0eSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5jb250YWlucyhzdG9yZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5ub3RpZnlQdXQoZW50aXR5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpYmVycyBhcmUgd2Vha2x5IHJlZmVyZW5jZWQuIEtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIFxyXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE9iamVjdEZ1bmN0aW9uIHRvIGVuc3VyZSBpdCBpcyBub3QgYXV0b21hdGljYWxseVxyXG4gICAgICogcmVtb3ZlZC5cclxuICAgICAqIFxyXG4gICAgICogQHR5cGUge1N0cmluZ30gc3RvcmVOYW1lXHJcbiAgICAgKiBAdHlwZSB7T2JqZWN0RnVuY3Rpb259IG9iamVjdEZ1bmN0aW9uXHJcbiAgICAgKi9cclxuICAgIHN1YnNjcmliZVB1dChzdG9yZU5hbWUsIG9iamVjdEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuY29udGFpbnMoc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuc2V0KHN0b3JlTmFtZSwgbmV3IFN1YnNjcmlwdGlvbk1hbmFnZXIoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5zdWJzY3JpYmUob2JqZWN0RnVuY3Rpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaWJlcnMgYXJlIHdlYWtseSByZWZlcmVuY2VkLiBLZWVwIGEgcmVmZXJlbmNlIHRvIHRoZSBcclxuICAgICAqIGluc3RhbmNlIG9mIHRoZSBPYmplY3RGdW5jdGlvbiB0byBlbnN1cmUgaXQgaXMgbm90IGF1dG9tYXRpY2FsbHlcclxuICAgICAqIHJlbW92ZWQuXHJcbiAgICAgKiBcclxuICAgICAqIEB0eXBlIHtTdHJpbmd9IHN0b3JlTmFtZVxyXG4gICAgICogQHR5cGUge09iamVjdEZ1bmN0aW9ufSBwdXRPYmplY3RGdW5jdGlvblxyXG4gICAgICogQHR5cGUge09iamVjdEZ1bmN0aW9ufSBkZWxldGVPYmplY3RGdW5jdGlvblxyXG4gICAgICovXHJcbiAgICBzdWJzY3JpYmUocHV0T2JqZWN0RnVuY3Rpb24sIGRlbGV0ZU9iamVjdEZ1bmN0aW9uLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5jb250YWlucyhzdG9yZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5zZXQoc3RvcmVOYW1lLCBuZXcgU3Vic2NyaXB0aW9uTWFuYWdlcigpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmdldChzdG9yZU5hbWUpLnN1YnNjcmliZShwdXRPYmplY3RGdW5jdGlvbiwgZGVsZXRlT2JqZWN0RnVuY3Rpb24pO1xyXG4gICAgfVxyXG5cclxufSJdLCJuYW1lcyI6WyJMT0ciLCJMb2dnZXIiLCJMaXN0IiwiT2JqZWN0RnVuY3Rpb24iLCJNYXAiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLE1BQU1BLEtBQUcsR0FBRyxJQUFJQyxrQkFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3RDO0FBQ08sTUFBTSxZQUFZLENBQUM7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksV0FBVyxDQUFDLFdBQVcsRUFBRTtBQUM3QixRQUFRLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0FBQ3ZDLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxRQUFRLENBQUMsa0JBQWtCLEVBQUU7QUFDakMsUUFBUUQsS0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ25DO0FBQ0E7QUFDQSxRQUFRLE1BQU0sRUFBRSxHQUFHLGtC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
