'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var coreutil_v1 = require('coreutil_v1');
var containerbridge_v1 = require('containerbridge_v1');

class IndexConfig {

    /**
     * 
     * @param {String} name 
     * @param {String} path 
     * @param {Boolean} unique 
     */
    constructor(name, path, unique) {

        /** @type {String} */
        this.name = name;

        /** @type {String} */
        this.path = path;

        /** @type {Boolean} */
        this.unique = unique;
    }

}

class StoreConfig {

    constructor() {

        /** @type {String} */
        this.storeName = null;

        /** @type {String} */
        this.keyPath = null;

        /** @type {List<IndexConfig>} */
        this.indexList = new coreutil_v1.List();

    }

    /**
     * 
     * @param {String} storeName 
     */
    withStoreName(storeName) {
        this.storeName = storeName;
        return this;
    }

    /**
     * 
     * @param {String} storeName 
     */
    withKeyPath(keyPath) {
        this.keyPath = keyPath;
        return this;
    }

    /**
     * 
     * @param {String} storeName 
     */
    withIndex(name, path, unique) {
        this.indexList.add(new IndexConfig(name, path, unique));
        return this;
    }

}

class DbConfig {


    constructor() {

        /** @type {Number} */
        this.version = 1;

        /** @type {List<StoreConfig} */
        this.storeConfigList = new coreutil_v1.List();
    }

    /**
     * 
     * @param {Number} version 
     */
     withVersion(version) {
        this.version = version;
        return this;
    }

    /**
     * 
     * @param {StoreConfig} storeConfig 
     */
    withStoreConfig(storeConfig) { 
        this.storeConfigList.add(storeConfig);
        return this;
    }


}

class SubscriptionManager {

    constructor() {
        this.putSubscribers = new coreutil_v1.List();
        this.deleteSubscribers = new coreutil_v1.List();
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the Method to ensure it is not automatically
     * removed.
     * 
     * @param {Method} putSubscriber 
     */
    subscribePut(putSubscriber) {
        if (putSubscriber instanceof coreutil_v1.Method) {
            this.putSubscribers.add(new WeakRef(putSubscriber));
        }
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the Method to ensure it is not automatically
     * removed.
     * 
     * @param {Method} deleteSubscriber 
     */
     subscribeDelete(deleteSubscriber) {
        if (deleteSubscriber instanceof coreutil_v1.Method) {
            this.deleteSubscribers.add(new WeakRef(deleteSubscriber));
        }
    }

    notifyPut(entity) {
        let toRemoveArray = [];
        this.putSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {Method} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(entity);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.putSubscribers.remove(toRemove);
        });
    }

    notifyDelete(key) {
        let toRemoveArray = [];
        this.deleteSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {Method} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(key);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.deleteSubscribers.remove(toRemove);
        });
    }

}

const LOG$1 = new coreutil_v1.Logger("StoreConfig");

class DBConfigurer {

    /**
     * 
     * @param {DbConfig} dbConfig 
     */
    constructor(dbConfig) {
        this.dbConfig = dbConfig;
    }

    /**
     * 
     * @param {IDBVersionChangeEvent} versionChangeEvent 
     */
    updgrade(versionChangeEvent) {
        LOG$1.info("Upgrade needed");

        /** @type {IDBDatabase} */
        const db = versionChangeEvent.target.result;

        this.dbConfig.storeConfigList.forEach((storeConfig) => {

            // Clear the old
            if (db.objectStoreNames.contains(storeConfig.storeName)) {
                db.deleteObjectStore(storeConfig.storeName);
            }
    
            // Create the new
            const store = db.createObjectStore(
                storeConfig.storeName, 
                { keyPath: storeConfig.keyPath }
            );
    
            storeConfig.indexList.forEach((indexConfig) => {
                const index = store.createIndex(
                    indexConfig.name, 
                    indexConfig.path, 
                    {unique: indexConfig.unique}
                );
                return true;
            });

            return true;
        });
    }

}

/**
 * Manages a database with 0 to many stores
 */
class DBManager {

    /**
     * 
     * @param {IDBDatabase} db 
     */
    constructor(db) {
        
        /** @type {IDBDatabase} */
        this.db = db;

        /** @type {Map<SubscriptionManager>} */
        this.subscriptionManagerMap = new coreutil_v1.Map();
    }

    /**
     * 
     * @param {String} dbName 
     * @param {DbConfig} dbConfig 
     * @return {Promise}
     */
    static fromStore(dbName, dbConfig) {
        const dbConfigurer = new DBConfigurer(dbConfig);
        return new Promise((resolve, reject) => {
            const openRequest = containerbridge_v1.ContainerDatabaseStorage.open(dbName, dbConfig.version);
            openRequest.onerror = (error) => {
                LOG.error(error);
                reject(error);
            };
            openRequest.onsuccess = () => {
                resolve(new DBManager(openRequest.result));
            };
            openRequest.onupgradeneeded = dbConfigurer.updgrade.bind(dbConfigurer);
        });
    }

    /**
     * @returns {Object}
     */
    static mapEntity(type, dataObject) {
        if (dataObject) {
            return Object.assign(new type, dataObject);
        }
        return null;
    }


    /**
     * 
     * @param {String} storeName 
     * @param {IDBTransactionMode} transactionType readwrite
     * @returns {IDBTransaction}
     */
    transaction(transactionType, storeName) {
        return this.db.transaction(storeName, transactionType);
    }

    /**
     * 
     * @param {IDBTransaction} transaction
     * @param {String} storeName
     * @returns {IDBOjectStore}
     */
    objectStore(transaction, storeName) {
        return transaction.objectStore(storeName);
    }

    /**
     * 
     * @param {IDBObjectStore} objectStore 
     * @param {String} indexName
     * @returns {IDBIndex}
     */
    index(objectStore, indexName) {
        return objectStore.index(indexName);
    }

    /**
     * @param {Object} entity
     * @param {String} storeName
     * @return {Promise}
     */
    putEntity(entity, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const putRequest = store.put(entity);
        const context = this;
        return new Promise((resolve, reject) => {
            putRequest.onsuccess = () => {
                context.notifyPut(entity, storeName);
                resolve(entity);
            };
            putRequest.onerror = (error) => {
                reject(error);
            };
        });
    }


    /**
     * 
     * @param {String} key 
     * @param {String} storeName
     * @param {Class} type
     * @returns {Promise}
     */
    getEntity(key, type, storeName) {
        const transaction = this.transaction("readonly", storeName);
        const userStore = transaction.objectStore(storeName);
        const getRequest = userStore.get(key);
        return new Promise((resolve, reject) => {
            getRequest.onsuccess = () => {
                resolve(DBManager.mapEntity(type, getRequest.result));
            };
            getRequest.onerror = (error) => {
                reject(error);
            };
        });
    }

    /**
     * 
     * @param {String} key 
     * @param {String} storeName
     * @returns {Promise}
     */
    deleteEntity(key, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const deleteRequest = store.delete(key);
        const context = this;
        return new Promise((resolve, reject) => {
            deleteRequest.onsuccess = () => {
                context.notifyDelete(key, storeName);
                resolve(deleteRequest.result);
            };
            deleteRequest.onerror = (error) => {
                reject(error);
            };
        });
    }

    notifyDelete(key, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyDelete(key);
        }
    }

    notifyPut(entity, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyPut(entity);
        }
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the Method to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {Method} putMethod
     */
    subscribePut(storeName, putMethod) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribePut(putMethod);
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the Method to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {Method} deleteMethod
     */
    subscribeDelete(storeName, deleteMethod) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribeDelete(deleteMethod);
    }

}

exports.DBConfigurer = DBConfigurer;
exports.DBManager = DBManager;
exports.DbConfig = DbConfig;
exports.IndexConfig = IndexConfig;
exports.StoreConfig = StoreConfig;
exports.SubscriptionManager = SubscriptionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0c3RvcmVfdjEuanMiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9pbmRleENvbmZpZy5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9zdG9yZUNvbmZpZy5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYkNvbmZpZy5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9zdWJzY3JpcHRpb25NYW5hZ2VyLmpzIiwiLi4vLi4vc3JjL29iamVjdHN0b3JlL2RiQ29uZmlndXJlci5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYk1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEluZGV4Q29uZmlnIHtcblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdW5pcXVlIFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHBhdGgsIHVuaXF1ZSkge1xuXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xuICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xuXG4gICAgICAgIC8qKiBAdHlwZSB7Qm9vbGVhbn0gKi9cbiAgICAgICAgdGhpcy51bmlxdWUgPSB1bmlxdWU7XG4gICAgfVxuXG59IiwiaW1wb3J0IHsgTGlzdCB9IGZyb20gXCJjb3JldXRpbF92MVwiO1xuaW1wb3J0IHsgSW5kZXhDb25maWcgfSBmcm9tIFwiLi9pbmRleENvbmZpZy5qc1wiO1xuXG5leHBvcnQgY2xhc3MgU3RvcmVDb25maWcge1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtTdHJpbmd9ICovXG4gICAgICAgIHRoaXMuc3RvcmVOYW1lID0gbnVsbDtcblxuICAgICAgICAvKiogQHR5cGUge1N0cmluZ30gKi9cbiAgICAgICAgdGhpcy5rZXlQYXRoID0gbnVsbDtcblxuICAgICAgICAvKiogQHR5cGUge0xpc3Q8SW5kZXhDb25maWc+fSAqL1xuICAgICAgICB0aGlzLmluZGV4TGlzdCA9IG5ldyBMaXN0KCk7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxuICAgICAqL1xuICAgIHdpdGhTdG9yZU5hbWUoc3RvcmVOYW1lKSB7XG4gICAgICAgIHRoaXMuc3RvcmVOYW1lID0gc3RvcmVOYW1lO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxuICAgICAqL1xuICAgIHdpdGhLZXlQYXRoKGtleVBhdGgpIHtcbiAgICAgICAgdGhpcy5rZXlQYXRoID0ga2V5UGF0aDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZSBcbiAgICAgKi9cbiAgICB3aXRoSW5kZXgobmFtZSwgcGF0aCwgdW5pcXVlKSB7XG4gICAgICAgIHRoaXMuaW5kZXhMaXN0LmFkZChuZXcgSW5kZXhDb25maWcobmFtZSwgcGF0aCwgdW5pcXVlKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxufSIsImltcG9ydCB7IExpc3QgfSBmcm9tIFwiY29yZXV0aWxfdjFcIjtcbmltcG9ydCB7IFN0b3JlQ29uZmlnIH0gZnJvbSBcIi4vc3RvcmVDb25maWdcIjtcblxuZXhwb3J0IGNsYXNzIERiQ29uZmlnIHtcblxuXG4gICAgY29uc3RydWN0b3IoKSB7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtOdW1iZXJ9ICovXG4gICAgICAgIHRoaXMudmVyc2lvbiA9IDE7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtMaXN0PFN0b3JlQ29uZmlnfSAqL1xuICAgICAgICB0aGlzLnN0b3JlQ29uZmlnTGlzdCA9IG5ldyBMaXN0KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHZlcnNpb24gXG4gICAgICovXG4gICAgIHdpdGhWZXJzaW9uKHZlcnNpb24pIHtcbiAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdG9yZUNvbmZpZ30gc3RvcmVDb25maWcgXG4gICAgICovXG4gICAgd2l0aFN0b3JlQ29uZmlnKHN0b3JlQ29uZmlnKSB7IFxuICAgICAgICB0aGlzLnN0b3JlQ29uZmlnTGlzdC5hZGQoc3RvcmVDb25maWcpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cblxufSIsImltcG9ydCB7IExpc3QsIE1ldGhvZCB9IGZyb20gXCJjb3JldXRpbF92MVwiO1xuXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uTWFuYWdlciB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5wdXRTdWJzY3JpYmVycyA9IG5ldyBMaXN0KCk7XG4gICAgICAgIHRoaXMuZGVsZXRlU3Vic2NyaWJlcnMgPSBuZXcgTGlzdCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXJzIGFyZSB3ZWFrbHkgcmVmZXJlbmNlZC4gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE1ldGhvZCB0byBlbnN1cmUgaXQgaXMgbm90IGF1dG9tYXRpY2FsbHlcbiAgICAgKiByZW1vdmVkLlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7TWV0aG9kfSBwdXRTdWJzY3JpYmVyIFxuICAgICAqL1xuICAgIHN1YnNjcmliZVB1dChwdXRTdWJzY3JpYmVyKSB7XG4gICAgICAgIGlmIChwdXRTdWJzY3JpYmVyIGluc3RhbmNlb2YgTWV0aG9kKSB7XG4gICAgICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLmFkZChuZXcgV2Vha1JlZihwdXRTdWJzY3JpYmVyKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVycyBhcmUgd2Vha2x5IHJlZmVyZW5jZWQuIEtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIFxuICAgICAqIGluc3RhbmNlIG9mIHRoZSBNZXRob2QgdG8gZW5zdXJlIGl0IGlzIG5vdCBhdXRvbWF0aWNhbGx5XG4gICAgICogcmVtb3ZlZC5cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge01ldGhvZH0gZGVsZXRlU3Vic2NyaWJlciBcbiAgICAgKi9cbiAgICAgc3Vic2NyaWJlRGVsZXRlKGRlbGV0ZVN1YnNjcmliZXIpIHtcbiAgICAgICAgaWYgKGRlbGV0ZVN1YnNjcmliZXIgaW5zdGFuY2VvZiBNZXRob2QpIHtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlU3Vic2NyaWJlcnMuYWRkKG5ldyBXZWFrUmVmKGRlbGV0ZVN1YnNjcmliZXIpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5vdGlmeVB1dChlbnRpdHkpIHtcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcbiAgICAgICAgdGhpcy5wdXRTdWJzY3JpYmVycy5mb3JFYWNoKCh3ZWFrUmVmU3Vic2NyaWJlciwgcGFyZW50KSA9PiB7XG4gICAgICAgICAgICAvKiogQHR5cGUge01ldGhvZH0gKi9cbiAgICAgICAgICAgIGxldCBzdWJzY3JpYmVyID0gd2Vha1JlZlN1YnNjcmliZXIuZGVyZWYoKTtcbiAgICAgICAgICAgIGlmICghc3Vic2NyaWJlcikge1xuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuY2FsbChlbnRpdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLnJlbW92ZSh0b1JlbW92ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5vdGlmeURlbGV0ZShrZXkpIHtcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcbiAgICAgICAgdGhpcy5kZWxldGVTdWJzY3JpYmVycy5mb3JFYWNoKCh3ZWFrUmVmU3Vic2NyaWJlciwgcGFyZW50KSA9PiB7XG4gICAgICAgICAgICAvKiogQHR5cGUge01ldGhvZH0gKi9cbiAgICAgICAgICAgIGxldCBzdWJzY3JpYmVyID0gd2Vha1JlZlN1YnNjcmliZXIuZGVyZWYoKTtcbiAgICAgICAgICAgIGlmICghc3Vic2NyaWJlcikge1xuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuY2FsbChrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZVN1YnNjcmliZXJzLnJlbW92ZSh0b1JlbW92ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSIsImltcG9ydCB7IExvZ2dlciB9IGZyb20gXCJjb3JldXRpbF92MVwiO1xuaW1wb3J0IHsgRGJDb25maWcgfSBmcm9tIFwiLi9kYkNvbmZpZ1wiO1xuXG5jb25zdCBMT0cgPSBuZXcgTG9nZ2VyKFwiU3RvcmVDb25maWdcIik7XG5cbmV4cG9ydCBjbGFzcyBEQkNvbmZpZ3VyZXIge1xuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtEYkNvbmZpZ30gZGJDb25maWcgXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZGJDb25maWcpIHtcbiAgICAgICAgdGhpcy5kYkNvbmZpZyA9IGRiQ29uZmlnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7SURCVmVyc2lvbkNoYW5nZUV2ZW50fSB2ZXJzaW9uQ2hhbmdlRXZlbnQgXG4gICAgICovXG4gICAgdXBkZ3JhZGUodmVyc2lvbkNoYW5nZUV2ZW50KSB7XG4gICAgICAgIExPRy5pbmZvKFwiVXBncmFkZSBuZWVkZWRcIik7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtJREJEYXRhYmFzZX0gKi9cbiAgICAgICAgY29uc3QgZGIgPSB2ZXJzaW9uQ2hhbmdlRXZlbnQudGFyZ2V0LnJlc3VsdDtcblxuICAgICAgICB0aGlzLmRiQ29uZmlnLnN0b3JlQ29uZmlnTGlzdC5mb3JFYWNoKChzdG9yZUNvbmZpZykgPT4ge1xuXG4gICAgICAgICAgICAvLyBDbGVhciB0aGUgb2xkXG4gICAgICAgICAgICBpZiAoZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzdG9yZUNvbmZpZy5zdG9yZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgZGIuZGVsZXRlT2JqZWN0U3RvcmUoc3RvcmVDb25maWcuc3RvcmVOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3XG4gICAgICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFxuICAgICAgICAgICAgICAgIHN0b3JlQ29uZmlnLnN0b3JlTmFtZSwgXG4gICAgICAgICAgICAgICAgeyBrZXlQYXRoOiBzdG9yZUNvbmZpZy5rZXlQYXRoIH1cbiAgICAgICAgICAgICk7XG4gICAgXG4gICAgICAgICAgICBzdG9yZUNvbmZpZy5pbmRleExpc3QuZm9yRWFjaCgoaW5kZXhDb25maWcpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHN0b3JlLmNyZWF0ZUluZGV4KFxuICAgICAgICAgICAgICAgICAgICBpbmRleENvbmZpZy5uYW1lLCBcbiAgICAgICAgICAgICAgICAgICAgaW5kZXhDb25maWcucGF0aCwgXG4gICAgICAgICAgICAgICAgICAgIHt1bmlxdWU6IGluZGV4Q29uZmlnLnVuaXF1ZX1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSIsImltcG9ydCB7IE1hcCwgTWV0aG9kIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XG5pbXBvcnQgeyBDb250YWluZXJEYXRhYmFzZVN0b3JhZ2UgfSBmcm9tIFwiY29udGFpbmVyYnJpZGdlX3YxXCI7XG5pbXBvcnQgeyBEQkNvbmZpZ3VyZXIgfSBmcm9tIFwiLi9kYkNvbmZpZ3VyZXIuanNcIjtcbmltcG9ydCB7IFN1YnNjcmlwdGlvbk1hbmFnZXIgfSBmcm9tIFwiLi9zdWJzY3JpcHRpb25NYW5hZ2VyLmpzXCI7XG5pbXBvcnQgeyBEYkNvbmZpZyB9IGZyb20gXCIuL2RiQ29uZmlnLmpzXCI7XG5cbi8qKlxuICogTWFuYWdlcyBhIGRhdGFiYXNlIHdpdGggMCB0byBtYW55IHN0b3Jlc1xuICovXG5leHBvcnQgY2xhc3MgREJNYW5hZ2VyIHtcblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7SURCRGF0YWJhc2V9IGRiIFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGRiKSB7XG4gICAgICAgIFxuICAgICAgICAvKiogQHR5cGUge0lEQkRhdGFiYXNlfSAqL1xuICAgICAgICB0aGlzLmRiID0gZGI7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtNYXA8U3Vic2NyaXB0aW9uTWFuYWdlcj59ICovXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcCA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGJOYW1lIFxuICAgICAqIEBwYXJhbSB7RGJDb25maWd9IGRiQ29uZmlnIFxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAgICovXG4gICAgc3RhdGljIGZyb21TdG9yZShkYk5hbWUsIGRiQ29uZmlnKSB7XG4gICAgICAgIGNvbnN0IGRiQ29uZmlndXJlciA9IG5ldyBEQkNvbmZpZ3VyZXIoZGJDb25maWcpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3BlblJlcXVlc3QgPSBDb250YWluZXJEYXRhYmFzZVN0b3JhZ2Uub3BlbihkYk5hbWUsIGRiQ29uZmlnLnZlcnNpb24pO1xuICAgICAgICAgICAgb3BlblJlcXVlc3Qub25lcnJvciA9IChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBEQk1hbmFnZXIob3BlblJlcXVlc3QucmVzdWx0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcGVuUmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBkYkNvbmZpZ3VyZXIudXBkZ3JhZGUuYmluZChkYkNvbmZpZ3VyZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgICAqL1xuICAgIHN0YXRpYyBtYXBFbnRpdHkodHlwZSwgZGF0YU9iamVjdCkge1xuICAgICAgICBpZiAoZGF0YU9iamVjdCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obmV3IHR5cGUsIGRhdGFPYmplY3QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZSBcbiAgICAgKiBAcGFyYW0ge0lEQlRyYW5zYWN0aW9uTW9kZX0gdHJhbnNhY3Rpb25UeXBlIHJlYWR3cml0ZVxuICAgICAqIEByZXR1cm5zIHtJREJUcmFuc2FjdGlvbn1cbiAgICAgKi9cbiAgICB0cmFuc2FjdGlvbih0cmFuc2FjdGlvblR5cGUsIHN0b3JlTmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIHRyYW5zYWN0aW9uVHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtJREJUcmFuc2FjdGlvbn0gdHJhbnNhY3Rpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lXG4gICAgICogQHJldHVybnMge0lEQk9qZWN0U3RvcmV9XG4gICAgICovXG4gICAgb2JqZWN0U3RvcmUodHJhbnNhY3Rpb24sIHN0b3JlTmFtZSkge1xuICAgICAgICByZXR1cm4gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge0lEQk9iamVjdFN0b3JlfSBvYmplY3RTdG9yZSBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5kZXhOYW1lXG4gICAgICogQHJldHVybnMge0lEQkluZGV4fVxuICAgICAqL1xuICAgIGluZGV4KG9iamVjdFN0b3JlLCBpbmRleE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG9iamVjdFN0b3JlLmluZGV4KGluZGV4TmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGVudGl0eVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWVcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHB1dEVudGl0eShlbnRpdHksIHN0b3JlTmFtZSkge1xuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IHRoaXMudHJhbnNhY3Rpb24oXCJyZWFkd3JpdGVcIiwgc3RvcmVOYW1lKTtcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xuICAgICAgICBjb25zdCBwdXRSZXF1ZXN0ID0gc3RvcmUucHV0KGVudGl0eSk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgcHV0UmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5ub3RpZnlQdXQoZW50aXR5LCBzdG9yZU5hbWUpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZW50aXR5KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBwdXRSZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWVcbiAgICAgKiBAcGFyYW0ge0NsYXNzfSB0eXBlXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZ2V0RW50aXR5KGtleSwgdHlwZSwgc3RvcmVOYW1lKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy50cmFuc2FjdGlvbihcInJlYWRvbmx5XCIsIHN0b3JlTmFtZSk7XG4gICAgICAgIGNvbnN0IHVzZXJTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XG4gICAgICAgIGNvbnN0IGdldFJlcXVlc3QgPSB1c2VyU3RvcmUuZ2V0KGtleSk7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBnZXRSZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKERCTWFuYWdlci5tYXBFbnRpdHkodHlwZSwgZ2V0UmVxdWVzdC5yZXN1bHQpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBnZXRSZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGtleSBcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZGVsZXRlRW50aXR5KGtleSwgc3RvcmVOYW1lKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy50cmFuc2FjdGlvbihcInJlYWR3cml0ZVwiLCBzdG9yZU5hbWUpO1xuICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XG4gICAgICAgIGNvbnN0IGRlbGV0ZVJlcXVlc3QgPSBzdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb250ZXh0Lm5vdGlmeURlbGV0ZShrZXksIHN0b3JlTmFtZSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkZWxldGVSZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZGVsZXRlUmVxdWVzdC5vbmVycm9yID0gKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5vdGlmeURlbGV0ZShrZXksIHN0b3JlTmFtZSkge1xuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmNvbnRhaW5zKHN0b3JlTmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5ub3RpZnlEZWxldGUoa2V5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5vdGlmeVB1dChlbnRpdHksIHN0b3JlTmFtZSkge1xuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmNvbnRhaW5zKHN0b3JlTmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5ub3RpZnlQdXQoZW50aXR5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXJzIGFyZSB3ZWFrbHkgcmVmZXJlbmNlZC4gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE1ldGhvZCB0byBlbnN1cmUgaXQgaXMgbm90IGF1dG9tYXRpY2FsbHlcbiAgICAgKiByZW1vdmVkLlxuICAgICAqIFxuICAgICAqIEB0eXBlIHtTdHJpbmd9IHN0b3JlTmFtZVxuICAgICAqIEB0eXBlIHtNZXRob2R9IHB1dE1ldGhvZFxuICAgICAqL1xuICAgIHN1YnNjcmliZVB1dChzdG9yZU5hbWUsIHB1dE1ldGhvZCkge1xuICAgICAgICBpZiAoIXRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5jb250YWlucyhzdG9yZU5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuc2V0KHN0b3JlTmFtZSwgbmV3IFN1YnNjcmlwdGlvbk1hbmFnZXIoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmdldChzdG9yZU5hbWUpLnN1YnNjcmliZVB1dChwdXRNZXRob2QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXJzIGFyZSB3ZWFrbHkgcmVmZXJlbmNlZC4gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE1ldGhvZCB0byBlbnN1cmUgaXQgaXMgbm90IGF1dG9tYXRpY2FsbHlcbiAgICAgKiByZW1vdmVkLlxuICAgICAqIFxuICAgICAqIEB0eXBlIHtTdHJpbmd9IHN0b3JlTmFtZVxuICAgICAqIEB0eXBlIHtNZXRob2R9IGRlbGV0ZU1ldGhvZFxuICAgICAqL1xuICAgIHN1YnNjcmliZURlbGV0ZShzdG9yZU5hbWUsIGRlbGV0ZU1ldGhvZCkge1xuICAgICAgICBpZiAoIXRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5jb250YWlucyhzdG9yZU5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuc2V0KHN0b3JlTmFtZSwgbmV3IFN1YnNjcmlwdGlvbk1hbmFnZXIoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmdldChzdG9yZU5hbWUpLnN1YnNjcmliZURlbGV0ZShkZWxldGVNZXRob2QpO1xuICAgIH1cblxufSJdLCJuYW1lcyI6WyJMaXN0IiwiTWV0aG9kIiwiTE9HIiwiTG9nZ2VyIiwiTWFwIiwiQ29udGFpbmVyRGF0YWJhc2VTdG9yYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQU8sTUFBTSxXQUFXLENBQUM7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLFdBQVcs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
