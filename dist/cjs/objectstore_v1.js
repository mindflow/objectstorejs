'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var coreutil_v1 = require('coreutil_v1');

const LOG$1 = new coreutil_v1.Logger("StoreConfig");

class DBConfigurer {

    /**
     * 
     * @param {StoreConfig} storeConfig 
     */
    constructor(storeConfig) {
        this.storeConfig = storeConfig;
    }

    /**
     * 
     * @param {IDBVersionChangeEvent} versionChangeEvent 
     */
    updgrade(versionChangeEvent) {
        LOG$1.info("Upgrade needed");

        /** @type {IDBDatabase} */
        const db = versionChangeEvent.target.result;

        if (db.objectStoreNames.contains(this.storeConfig.storeName)) {
            db.deleteObjectStore(this.storeConfig.storeName);
        }

        const store = db.createObjectStore(
            this.storeConfig.storeName, 
            { keyPath: this.storeConfig.keyPath }
        );

        const index = store.createIndex(
            this.storeConfig.indexName, 
            this.storeConfig.indexPath, 
            {unique: this.storeConfig.indexUnique}
        );
    }

}

class IndexConfig {

    /**
     * 
     * @param {String} name 
     * @param {String} path 
     * @param {Boolean} unique 
     */
    constructor(name, path, unique) {

        /** @type {String} */
        this.name = name;

        /** @type {String} */
        this.path = path;

        /** @type {Boolean} */
        this.unique = unique;
    }

}

class StoreConfig {

        constructor() {

            /** @type {Number} */
            this.version = 1;

            /** @type {String} */
            this.storeName = null;

            /** @type {String} */
            this.keyPath = null;

            /** @type {List} */
            this.indexList = new coreutil_v1.List();

        }

        /**
         * 
         * @param {Number} version 
         */
        withVersion(version) {
            this.version = version;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withStoreName(storeName) {
            this.storeName = storeName;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withKeyPath(keyPath) {
            this.keyPath = keyPath;
            return this;
        }

        /**
         * 
         * @param {String} storeName 
         */
        withIndex(name, path, unique) {
            this.indexList.add(new IndexConfig(name, path, unique));
            return this;
        }

}

class SubscriptionManager {

    constructor() {
        this.putSubscribers = new coreutil_v1.List();
        this.deleteSubscribers = new coreutil_v1.List();
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @param {ObjectFunction} putSubscriber 
     * @param {ObjectFunction} deleteSubscriber 
     */
    subscribe(putSubscriber, deleteSubscriber) {
        if (putSubscriber instanceof coreutil_v1.ObjectFunction) {
            this.putSubscribers.add(new WeakRef(putSubscriber));
        }
        if (deleteSubscriber instanceof coreutil_v1.ObjectFunction) {
            this.deleteSubscribers.add(new WeakRef(deleteSubscriber));
        }
    }

    notifyPut(entity) {
        let toRemoveArray = [];
        this.putSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {ObjectFunction} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(entity);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.putSubscribers.remove(toRemove);
        });
    }

    notifyDelete(key) {
        let toRemoveArray = [];
        this.deleteSubscribers.forEach((weakRefSubscriber, parent) => {
            /** @type {ObjectFunction} */
            let subscriber = weakRefSubscriber.deref();
            if (!subscriber) {
                toRemoveArray.push(weakRefSubscriber);
            } else {
                subscriber.call(key);
            }
            return true;
        }, this);
        new coreutil_v1.List(toRemoveArray).forEach((toRemove, parent) => {
            this.deleteSubscribers.remove(toRemove);
        });
    }

}

/**
 * Manages a database with 0 to many stores
 */
class DBManager {

    /**
     * 
     * @param {IDBDatabase} db 
     */
    constructor(db) {
        
        /** @type {IDBDatabase} */
        this.db = db;

        /** @type {Map} */
        this.subscriptionManagerMap = new coreutil_v1.Map();
    }

    /**
     * 
     * @param {String} dbName 
     * @param {StoreConfig} storeConfig 
     * @return {Promise}
     */
    static fromStore(dbName, storeConfig) {
        const dbConfigurer = new DBConfigurer(storeConfig);
        return new Promise((resolve, reject) => {
            const openRequest = window.indexedDB.open(dbName, 1);
            openRequest.onerror = (error) => {
                LOG.error(error);
                reject(error);
            };
            openRequest.onsuccess = () => {
                resolve(new DBManager(openRequest.result));
            };
            openRequest.onupgradeneeded = dbConfigurer.updgrade.bind(dbConfigurer);
        });
    }

    /**
     * @returns {Object}
     */
    static mapEntity(type, dataObject) {
        if (dataObject) {
            return Object.assign(new type, dataObject);
        }
        return null;
    }


    /**
     * 
     * @param {String} storeName 
     * @param {IDBTransactionMode} transactionType readwrite
     * @returns {IDBTransaction}
     */
    transaction(transactionType, storeName) {
        return this.db.transaction(storeName, transactionType);
    }

    /**
     * 
     * @param {IDBTransaction} transaction
     * @param {String} storeName
     * @returns {IDBOjectStore}
     */
    objectStore(transaction, storeName) {
        return transaction.objectStore(storeName);
    }

    /**
     * 
     * @param {IDBObjectStore} objectStore 
     * @param {String} indexName
     * @returns {IDBIndex}
     */
    index(objectStore, indexName) {
        return objectStore.index(indexName);
    }

    /**
     * @param {Object} entity
     * @param {String} storeName
     * @param {String} transactionType
     * @return {Promise}
     */
    putEntity(entity, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const putRequest = store.put(entity);
        const context = this;
        return new Promise((resolve, reject) => {
            putRequest.onsuccess = () => { context.notifyPut(entity, storeName); resolve(entity); };
            putRequest.onerror = (error) => { reject(error); };
        });
    }


        /**
     * 
     * @param {String} key 
     * @param {String} storeName
     * @param {Class} type
     * @returns {Promise}
     */
    getEntity(key, type, storeName) {
        const transaction = this.transaction("readonly", storeName);
        const userStore = transaction.objectStore(storeName);
        const getRequest = userStore.get(key);
        return new Promise((resolve, reject) => {
            getRequest.onsuccess = () => { resolve(DBManager.mapEntity(type, getRequest.result)); };
            getRequest.onerror = (error) => { reject(error); };
        });
    }

    /**
     * 
     * @param {String} key 
     * @returns {Promise}
     */
    deleteEntity(key, storeName) {
        const transaction = this.transaction("readwrite", storeName);
        const store = transaction.objectStore(storeName);
        const deleteRequest = store.delete(key);
        const context = this;
        return new Promise((resolve, reject) => {
            deleteRequest.onsuccess = () => {  context.notifyDelete(key, storeName); resolve(deleteRequest.result); };
            deleteRequest.onerror = (error) => {reject(error); };
        });
    }

    notifyDelete(key, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyDelete(key);
        }
    }

    notifyPut(entity, storeName) {
        if (this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.get(storeName).notifyPut(entity);
        }
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {ObjectFunction} objectFunction
     */
    subscribePut(storeName, objectFunction) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribe(objectFunction);
    }

    /**
     * Subscribers are weakly referenced. Keep a reference to the 
     * instance of the ObjectFunction to ensure it is not automatically
     * removed.
     * 
     * @type {String} storeName
     * @type {ObjectFunction} putObjectFunction
     * @type {ObjectFunction} deleteObjectFunction
     */
    subscribe(putObjectFunction, deleteObjectFunction, storeName) {
        if (!this.subscriptionManagerMap.contains(storeName)) {
            this.subscriptionManagerMap.set(storeName, new SubscriptionManager());
        }
        this.subscriptionManagerMap.get(storeName).subscribe(putObjectFunction, deleteObjectFunction);
    }

}

exports.DBConfigurer = DBConfigurer;
exports.DBManager = DBManager;
exports.IndexConfig = IndexConfig;
exports.StoreConfig = StoreConfig;
exports.SubscriptionManager = SubscriptionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0c3RvcmVfdjEuanMiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYkNvbmZpZ3VyZXIuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvaW5kZXhDb25maWcuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvc3RvcmVDb25maWcuanMiLCIuLi8uLi9zcmMvb2JqZWN0c3RvcmUvc3Vic2NyaXB0aW9uTWFuYWdlci5qcyIsIi4uLy4uL3NyYy9vYmplY3RzdG9yZS9kYk1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcblxyXG5jb25zdCBMT0cgPSBuZXcgTG9nZ2VyKFwiU3RvcmVDb25maWdcIik7XHJcblxyXG5leHBvcnQgY2xhc3MgREJDb25maWd1cmVyIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtTdG9yZUNvbmZpZ30gc3RvcmVDb25maWcgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHN0b3JlQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yZUNvbmZpZyA9IHN0b3JlQ29uZmlnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge0lEQlZlcnNpb25DaGFuZ2VFdmVudH0gdmVyc2lvbkNoYW5nZUV2ZW50IFxyXG4gICAgICovXHJcbiAgICB1cGRncmFkZSh2ZXJzaW9uQ2hhbmdlRXZlbnQpIHtcclxuICAgICAgICBMT0cuaW5mbyhcIlVwZ3JhZGUgbmVlZGVkXCIpO1xyXG5cclxuICAgICAgICAvKiogQHR5cGUge0lEQkRhdGFiYXNlfSAqL1xyXG4gICAgICAgIGNvbnN0IGRiID0gdmVyc2lvbkNoYW5nZUV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgIGlmIChkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHRoaXMuc3RvcmVDb25maWcuc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICBkYi5kZWxldGVPYmplY3RTdG9yZSh0aGlzLnN0b3JlQ29uZmlnLnN0b3JlTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFxyXG4gICAgICAgICAgICB0aGlzLnN0b3JlQ29uZmlnLnN0b3JlTmFtZSwgXHJcbiAgICAgICAgICAgIHsga2V5UGF0aDogdGhpcy5zdG9yZUNvbmZpZy5rZXlQYXRoIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBpbmRleCA9IHN0b3JlLmNyZWF0ZUluZGV4KFxyXG4gICAgICAgICAgICB0aGlzLnN0b3JlQ29uZmlnLmluZGV4TmFtZSwgXHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmVDb25maWcuaW5kZXhQYXRoLCBcclxuICAgICAgICAgICAge3VuaXF1ZTogdGhpcy5zdG9yZUNvbmZpZy5pbmRleFVuaXF1ZX1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxufSIsImV4cG9ydCBjbGFzcyBJbmRleENvbmZpZyB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGggXHJcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHVuaXF1ZSBcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgcGF0aCwgdW5pcXVlKSB7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7U3RyaW5nfSAqL1xyXG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XHJcblxyXG4gICAgICAgIC8qKiBAdHlwZSB7Qm9vbGVhbn0gKi9cclxuICAgICAgICB0aGlzLnVuaXF1ZSA9IHVuaXF1ZTtcclxuICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBMaXN0IH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcbmltcG9ydCB7IEluZGV4Q29uZmlnIH0gZnJvbSBcIi4vaW5kZXhDb25maWcuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTdG9yZUNvbmZpZyB7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtOdW1iZXJ9ICovXHJcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IDE7XHJcblxyXG4gICAgICAgICAgICAvKiogQHR5cGUge1N0cmluZ30gKi9cclxuICAgICAgICAgICAgdGhpcy5zdG9yZU5hbWUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtTdHJpbmd9ICovXHJcbiAgICAgICAgICAgIHRoaXMua2V5UGF0aCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvKiogQHR5cGUge0xpc3R9ICovXHJcbiAgICAgICAgICAgIHRoaXMuaW5kZXhMaXN0ID0gbmV3IExpc3QoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gdmVyc2lvbiBcclxuICAgICAgICAgKi9cclxuICAgICAgICB3aXRoVmVyc2lvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogXHJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHN0b3JlTmFtZSBcclxuICAgICAgICAgKi9cclxuICAgICAgICB3aXRoU3RvcmVOYW1lKHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlTmFtZSA9IHN0b3JlTmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHdpdGhLZXlQYXRoKGtleVBhdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5rZXlQYXRoID0ga2V5UGF0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lIFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHdpdGhJbmRleChuYW1lLCBwYXRoLCB1bmlxdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5pbmRleExpc3QuYWRkKG5ldyBJbmRleENvbmZpZyhuYW1lLCBwYXRoLCB1bmlxdWUpKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxufSIsImltcG9ydCB7IExpc3QsIE9iamVjdEZ1bmN0aW9uIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3Vic2NyaXB0aW9uTWFuYWdlciB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5wdXRTdWJzY3JpYmVycyA9IG5ldyBMaXN0KCk7XHJcbiAgICAgICAgdGhpcy5kZWxldGVTdWJzY3JpYmVycyA9IG5ldyBMaXN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpYmVycyBhcmUgd2Vha2x5IHJlZmVyZW5jZWQuIEtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIFxyXG4gICAgICogaW5zdGFuY2Ugb2YgdGhlIE9iamVjdEZ1bmN0aW9uIHRvIGVuc3VyZSBpdCBpcyBub3QgYXV0b21hdGljYWxseVxyXG4gICAgICogcmVtb3ZlZC5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtPYmplY3RGdW5jdGlvbn0gcHV0U3Vic2NyaWJlciBcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0RnVuY3Rpb259IGRlbGV0ZVN1YnNjcmliZXIgXHJcbiAgICAgKi9cclxuICAgIHN1YnNjcmliZShwdXRTdWJzY3JpYmVyLCBkZWxldGVTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgaWYgKHB1dFN1YnNjcmliZXIgaW5zdGFuY2VvZiBPYmplY3RGdW5jdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLmFkZChuZXcgV2Vha1JlZihwdXRTdWJzY3JpYmVyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZWxldGVTdWJzY3JpYmVyIGluc3RhbmNlb2YgT2JqZWN0RnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kZWxldGVTdWJzY3JpYmVycy5hZGQobmV3IFdlYWtSZWYoZGVsZXRlU3Vic2NyaWJlcikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBub3RpZnlQdXQoZW50aXR5KSB7XHJcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLnB1dFN1YnNjcmliZXJzLmZvckVhY2goKHdlYWtSZWZTdWJzY3JpYmVyLCBwYXJlbnQpID0+IHtcclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gKi9cclxuICAgICAgICAgICAgbGV0IHN1YnNjcmliZXIgPSB3ZWFrUmVmU3Vic2NyaWJlci5kZXJlZigpO1xyXG4gICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNhbGwoZW50aXR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHV0U3Vic2NyaWJlcnMucmVtb3ZlKHRvUmVtb3ZlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBub3RpZnlEZWxldGUoa2V5KSB7XHJcbiAgICAgICAgbGV0IHRvUmVtb3ZlQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmRlbGV0ZVN1YnNjcmliZXJzLmZvckVhY2goKHdlYWtSZWZTdWJzY3JpYmVyLCBwYXJlbnQpID0+IHtcclxuICAgICAgICAgICAgLyoqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gKi9cclxuICAgICAgICAgICAgbGV0IHN1YnNjcmliZXIgPSB3ZWFrUmVmU3Vic2NyaWJlci5kZXJlZigpO1xyXG4gICAgICAgICAgICBpZiAoIXN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIHRvUmVtb3ZlQXJyYXkucHVzaCh3ZWFrUmVmU3Vic2NyaWJlcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNhbGwoa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICBuZXcgTGlzdCh0b1JlbW92ZUFycmF5KS5mb3JFYWNoKCh0b1JlbW92ZSwgcGFyZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlU3Vic2NyaWJlcnMucmVtb3ZlKHRvUmVtb3ZlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgeyBNYXAsIE9iamVjdEZ1bmN0aW9uIH0gZnJvbSBcImNvcmV1dGlsX3YxXCI7XHJcbmltcG9ydCB7IERCQ29uZmlndXJlciB9IGZyb20gXCIuL2RiQ29uZmlndXJlci5qc1wiO1xyXG5pbXBvcnQgeyBTdG9yZUNvbmZpZyB9IGZyb20gXCIuL3N0b3JlQ29uZmlnLmpzXCI7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbk1hbmFnZXIgfSBmcm9tIFwiLi9zdWJzY3JpcHRpb25NYW5hZ2VyLmpzXCI7XHJcblxyXG4vKipcclxuICogTWFuYWdlcyBhIGRhdGFiYXNlIHdpdGggMCB0byBtYW55IHN0b3Jlc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIERCTWFuYWdlciB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7SURCRGF0YWJhc2V9IGRiIFxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihkYikge1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8qKiBAdHlwZSB7SURCRGF0YWJhc2V9ICovXHJcbiAgICAgICAgdGhpcy5kYiA9IGRiO1xyXG5cclxuICAgICAgICAvKiogQHR5cGUge01hcH0gKi9cclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYk5hbWUgXHJcbiAgICAgKiBAcGFyYW0ge1N0b3JlQ29uZmlnfSBzdG9yZUNvbmZpZyBcclxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmcm9tU3RvcmUoZGJOYW1lLCBzdG9yZUNvbmZpZykge1xyXG4gICAgICAgIGNvbnN0IGRiQ29uZmlndXJlciA9IG5ldyBEQkNvbmZpZ3VyZXIoc3RvcmVDb25maWcpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZW5SZXF1ZXN0ID0gd2luZG93LmluZGV4ZWREQi5vcGVuKGRiTmFtZSwgMSk7XHJcbiAgICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IERCTWFuYWdlcihvcGVuUmVxdWVzdC5yZXN1bHQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcGVuUmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBkYkNvbmZpZ3VyZXIudXBkZ3JhZGUuYmluZChkYkNvbmZpZ3VyZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHJldHVybnMge09iamVjdH1cclxuICAgICAqL1xyXG4gICAgc3RhdGljIG1hcEVudGl0eSh0eXBlLCBkYXRhT2JqZWN0KSB7XHJcbiAgICAgICAgaWYgKGRhdGFPYmplY3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obmV3IHR5cGUsIGRhdGFPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWUgXHJcbiAgICAgKiBAcGFyYW0ge0lEQlRyYW5zYWN0aW9uTW9kZX0gdHJhbnNhY3Rpb25UeXBlIHJlYWR3cml0ZVxyXG4gICAgICogQHJldHVybnMge0lEQlRyYW5zYWN0aW9ufVxyXG4gICAgICovXHJcbiAgICB0cmFuc2FjdGlvbih0cmFuc2FjdGlvblR5cGUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgdHJhbnNhY3Rpb25UeXBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtJREJUcmFuc2FjdGlvbn0gdHJhbnNhY3Rpb25cclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWVcclxuICAgICAqIEByZXR1cm5zIHtJREJPamVjdFN0b3JlfVxyXG4gICAgICovXHJcbiAgICBvYmplY3RTdG9yZSh0cmFuc2FjdGlvbiwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7SURCT2JqZWN0U3RvcmV9IG9iamVjdFN0b3JlIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGluZGV4TmFtZVxyXG4gICAgICogQHJldHVybnMge0lEQkluZGV4fVxyXG4gICAgICovXHJcbiAgICBpbmRleChvYmplY3RTdG9yZSwgaW5kZXhOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIG9iamVjdFN0b3JlLmluZGV4KGluZGV4TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZW50aXR5XHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RvcmVOYW1lXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHJhbnNhY3Rpb25UeXBlXHJcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfVxyXG4gICAgICovXHJcbiAgICBwdXRFbnRpdHkoZW50aXR5LCBzdG9yZU5hbWUpIHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IHRoaXMudHJhbnNhY3Rpb24oXCJyZWFkd3JpdGVcIiwgc3RvcmVOYW1lKTtcclxuICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICAgICAgY29uc3QgcHV0UmVxdWVzdCA9IHN0b3JlLnB1dChlbnRpdHkpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHB1dFJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4geyBjb250ZXh0Lm5vdGlmeVB1dChlbnRpdHksIHN0b3JlTmFtZSk7IHJlc29sdmUoZW50aXR5KTsgfTtcclxuICAgICAgICAgICAgcHV0UmVxdWVzdC5vbmVycm9yID0gKGVycm9yKSA9PiB7IHJlamVjdChlcnJvcik7IH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgICAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGtleSBcclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdG9yZU5hbWVcclxuICAgICAqIEBwYXJhbSB7Q2xhc3N9IHR5cGVcclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICovXHJcbiAgICBnZXRFbnRpdHkoa2V5LCB0eXBlLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IHRoaXMudHJhbnNhY3Rpb24oXCJyZWFkb25seVwiLCBzdG9yZU5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJTdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICAgICAgY29uc3QgZ2V0UmVxdWVzdCA9IHVzZXJTdG9yZS5nZXQoa2V5KTtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBnZXRSZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHsgcmVzb2x2ZShEQk1hbmFnZXIubWFwRW50aXR5KHR5cGUsIGdldFJlcXVlc3QucmVzdWx0KSk7IH07XHJcbiAgICAgICAgICAgIGdldFJlcXVlc3Qub25lcnJvciA9IChlcnJvcikgPT4geyByZWplY3QoZXJyb3IpOyB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XHJcbiAgICAgKi9cclxuICAgIGRlbGV0ZUVudGl0eShrZXksIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gdGhpcy50cmFuc2FjdGlvbihcInJlYWR3cml0ZVwiLCBzdG9yZU5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgICAgICBjb25zdCBkZWxldGVSZXF1ZXN0ID0gc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgZGVsZXRlUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7ICBjb250ZXh0Lm5vdGlmeURlbGV0ZShrZXksIHN0b3JlTmFtZSk7IHJlc29sdmUoZGVsZXRlUmVxdWVzdC5yZXN1bHQpOyB9O1xyXG4gICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uZXJyb3IgPSAoZXJyb3IpID0+IHtyZWplY3QoZXJyb3IpOyB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5vdGlmeURlbGV0ZShrZXksIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuY29udGFpbnMoc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuZ2V0KHN0b3JlTmFtZSkubm90aWZ5RGVsZXRlKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5vdGlmeVB1dChlbnRpdHksIHN0b3JlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuY29udGFpbnMoc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuZ2V0KHN0b3JlTmFtZSkubm90aWZ5UHV0KGVudGl0eSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaWJlcnMgYXJlIHdlYWtseSByZWZlcmVuY2VkLiBLZWVwIGEgcmVmZXJlbmNlIHRvIHRoZSBcclxuICAgICAqIGluc3RhbmNlIG9mIHRoZSBPYmplY3RGdW5jdGlvbiB0byBlbnN1cmUgaXQgaXMgbm90IGF1dG9tYXRpY2FsbHlcclxuICAgICAqIHJlbW92ZWQuXHJcbiAgICAgKiBcclxuICAgICAqIEB0eXBlIHtTdHJpbmd9IHN0b3JlTmFtZVxyXG4gICAgICogQHR5cGUge09iamVjdEZ1bmN0aW9ufSBvYmplY3RGdW5jdGlvblxyXG4gICAgICovXHJcbiAgICBzdWJzY3JpYmVQdXQoc3RvcmVOYW1lLCBvYmplY3RGdW5jdGlvbikge1xyXG4gICAgICAgIGlmICghdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLmNvbnRhaW5zKHN0b3JlTmFtZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25NYW5hZ2VyTWFwLnNldChzdG9yZU5hbWUsIG5ldyBTdWJzY3JpcHRpb25NYW5hZ2VyKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuZ2V0KHN0b3JlTmFtZSkuc3Vic2NyaWJlKG9iamVjdEZ1bmN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmliZXJzIGFyZSB3ZWFrbHkgcmVmZXJlbmNlZC4gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgXHJcbiAgICAgKiBpbnN0YW5jZSBvZiB0aGUgT2JqZWN0RnVuY3Rpb24gdG8gZW5zdXJlIGl0IGlzIG5vdCBhdXRvbWF0aWNhbGx5XHJcbiAgICAgKiByZW1vdmVkLlxyXG4gICAgICogXHJcbiAgICAgKiBAdHlwZSB7U3RyaW5nfSBzdG9yZU5hbWVcclxuICAgICAqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gcHV0T2JqZWN0RnVuY3Rpb25cclxuICAgICAqIEB0eXBlIHtPYmplY3RGdW5jdGlvbn0gZGVsZXRlT2JqZWN0RnVuY3Rpb25cclxuICAgICAqL1xyXG4gICAgc3Vic2NyaWJlKHB1dE9iamVjdEZ1bmN0aW9uLCBkZWxldGVPYmplY3RGdW5jdGlvbiwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuY29udGFpbnMoc3RvcmVOYW1lKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hbmFnZXJNYXAuc2V0KHN0b3JlTmFtZSwgbmV3IFN1YnNjcmlwdGlvbk1hbmFnZXIoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uTWFuYWdlck1hcC5nZXQoc3RvcmVOYW1lKS5zdWJzY3JpYmUocHV0T2JqZWN0RnVuY3Rpb24sIGRlbGV0ZU9iamVjdEZ1bmN0aW9uKTtcclxuICAgIH1cclxuXHJcbn0iXSwibmFtZXMiOlsiTE9HIiwiTG9nZ2VyIiwiTGlzdCIsIk9iamVjdEZ1bmN0aW9uIiwiTWFwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxNQUFNQSxLQUFHLEdBQUcsSUFBSUMsa0JBQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN0QztBQUNPLE1BQU0sWUFBWSxDQUFDO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUU7QUFDN0IsUUFBUSxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztBQUN2QyxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksUUFBUSxDQUFDLGtCQUFrQixFQUFFO0FBQ2pDLFFBQVFELEtBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUNuQztBQUNBO0FBQ0EsUUFB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
